[
  {
    "question": "Provide me a list of the top 20 worst applications for wait time, providing the average duration/instance PIVOTED by the power state. Ignore the following list of processes in compiling the list: 'DUMMY_PROCESS', 'DESKTOP', 'explorer.exe', 'RESTRICTED PROCESS', and 'UNKNOWN'. Also ignore any events that are either 'TOTAL_NON_WAIT_EVENTS' or 'TOTAL_DISCARDED_WAIT_EVENTS', as they are not applicable to this analysis. The final column definition should be the processes, the AC average duration per instance, the DC average duration per instance, and the UNknown average duration per instance.",
    "sql": "select proc_name, sum(case when acdc = 'AC' then round(aggragated_duration_in_seconds/number_of_instances, 2) else 0 end) as ac_duration, sum(case when acdc = 'DC' then round(aggragated_duration_in_seconds/number_of_instances, 2) else 0 end) as dc_duration, sum(case when acdc = 'UN' then round(aggragated_duration_in_seconds/number_of_instances, 2) else 0 end) as unknown_duration from (select procs.proc_name, uw.acdc, sum(uw.number_of_instances) as number_of_instances, sum(total_duration_ms / 1000.0) as aggragated_duration_in_seconds, count(distinct uw.guid) as number_of_systems from (select proc_name, round(total_duration_sec_per_instance, 2) as total_duration_sec_per_instance, rank from (select proc_name, sum((total_duration_ms / 1000)) / sum(number_of_instances) as total_duration_sec_per_instance, rank() over (order by sum((total_duration_ms / 1000)) / sum(number_of_instances) desc) as rank from reporting.system_userwait where proc_name not in ('DUMMY_PROCESS', 'DESKTOP', 'explorer.exe', 'RESTRICTED PROCESS', 'UNKNOWN') and event_name NOT in ('TOTAL_NON_WAIT_EVENTS', 'TOTAL_DISCARDED_WAIT_EVENTS') group by proc_name having sum(number_of_instances) > 50 and count(distinct guid) > 20 order by rank desc) inn order by rank asc) procs inner join reporting.system_userwait uw on procs.proc_name = uw.proc_name where procs.rank <= 20 group by procs.proc_name, uw.acdc) a group by proc_name;",
    "db_id": "dw",
    "mapping": {},
    "join_keys": [],
    "gold_tables": []
  }
]